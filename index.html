<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>To Do List</title>
	<link rel='stylesheet' type='text/css' href='index.css'> 
	<script
  src="https://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  crossorigin="anonymous"></script>
  <script type='text/javascript' src='jquery.js'></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.css"></script>
<script src="moment.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
<link rel="stylesheet" type="text/css" href="iziModal.css">
<script type='text/javascript' src="colResizable.js"></script>
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
<script>
		//drag and drop events
	function drag(event) {
		let i = [event.target.children[1].children[0].id];
		let x = Array.from(document.getElementsByClassName('selected')).map(e=>e.id);
		i = i.concat(x);
		i.sort((a,b) => a-b);
		i = Array.from(new Set(i));
	    event.dataTransfer.setData("text", i);
	};
	function allowDrop(ev) {
	    ev.preventDefault();
	}
	function drop(ev) {
		ev.preventDefault();
    	var data = ev.dataTransfer.getData("text").split(',');
    	let data1 = $(ev.target)[0].id;
    	if(!data1) {
    		data1 = $(ev.target).parents('tr')[0].children[1].children[0].id;
    	}
    	if(data.indexOf(data1) > -1) {
    		return undefined;
    	} else {
			rearrangement(data,data1);    		
    	}
		$('.containerX.display-item:odd').css('background-color','rgb(100, 200, 255, 0.25)');
		$('.containerX.display-item:even').css('background-color','rgb(150, 250, 200, 0.25)');
		$('.container.categoryX:odd').css('background-color','rgb(100, 200, 255, 0.25)');
		$('.container.categoryX:even').css('background-color','rgb(150, 250, 200, 0.25)');
    	//ev.target.append(document.getElementById(data));
	}
	function rearrangement(key1,key2) {
		let arra = [];
		key1 = key1.map(e => Number(e));
		let data1 = JSON.parse(localStorage.getItem(key2))[3];
		for(let i = 0 ; i < localStorage.length ; i++) {
			if(key1.indexOf(i) > -1) {

			} else if (JSON.parse(localStorage.getItem(i))[3] === data1) {
				key1.forEach(function(element) {
					arra.push(JSON.parse(localStorage.getItem(element)));
				})
				arra.push(JSON.parse(localStorage.getItem(i)));
			} else {
				arra.push(JSON.parse(localStorage.getItem(i)));
			}
		}
		localStorage.clear();
		for(let i = 0; i < arra.length; i++) {
			arra[i][3] = i;
			localStorage.setItem(i,JSON.stringify(arra[i]));
		}
		$('.displaycontents').html(`<tr><th style='width:20%;' class='headings'>Category</th><th style='width:70%;' class='headings'>Content</th><th style='width:10%;' class='headings'>Date</th></tr>`)
		let localKey = Object.keys(localStorage);
		localKey.forEach(function(element) {
			let item = JSON.parse(localStorage.getItem(element));
			if(element !== undefined) {
				let itemHtml = $(`<tr draggable='true' ondragstart='drag(event)' ondrop='drop(event)' ondragover='allowDrop(event)'><td><div class='container categoryX'>${item[0]}<img class='editbutton' src='editbutton.png'></div></td><td><div class='containerX display-item' id='${element}'>${item[1]} <img class='editbutton' src='editbutton.png'></div></td><td><div class='container date'>${item[2]}</div></td></tr>`);
				$('.displaycontents').append(itemHtml);
			}
		})	
	};
	//drag and drop events
</script>
</head>
<body>
<script type='text/javascript' src="iziModal.js"></script>
<script src='app.js'></script>
	<div id='modal' class='iziModal'>
		<div class='popupbox'>
			<div class='contents col-8'><h3>Content</h3><textarea style='resize:none;height:350px;width:350px;' input='text' class='contentblock' placeholder='type your content here'></textarea></div>
			<div class='contents col-4'><h3>Category</h3><input class='category' type='text' placeholder='type your category here' style='width:200px;'/><br><hr>
				<h3>Options:</h3>
				<code>&lt;br&gt;: new line.<br>&lt;b&gt;: bold<br>&lt;em&gt;: italics.<br>&lt;sub&gt;: Subscript text.<br>&lt;sup&gt;: Superscript text.</code>
				<br><button class='submitbutton'>Submit</button>
			</div>		
		</div>
	</div>
	<div class='container'>
		<input type='text' class='user-input'>
		<button class='add-text-btn'>Add Item</button>
		<button class='sel-all-btn'>Select All</button>
		<button class='de-sel-all-btn'>Deselect All</button>
		<button class='del-text-btn'>Delete Item</button>
		<button class='trigger'>Form</button>
	</div>
	<br><hr><br>
	<div class='display'>
		<table class='displaycontents'>
			<tr>
				<th style='width:20%;' class='headings'>Category</th>
				<th style='width:70%;' class='headings'>Content</th>
				<th style='width:10%;' class='headings'>Date</th>
			</tr>
		</table>
	</div>


	<!--MODALS BOOTSTRAP -->
	<!--	Modal HTML embedded directly into document

<div id="ex1" class="modal">
  <p>Thanks for clicking. That felt good.</p>
  <a href="#" rel="modal:close">Close</a>
</div>

	Link to open the modal -->
	<!--MODALS BOOTSTRAP-->

</body>
</html>